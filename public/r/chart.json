{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "chart",
  "dependencies": ["echarts"],
  "registryDependencies": [],
  "files": [
    {
      "path": "src/registry/ui/chart.tsx",
      "content": "import type { ECharts, EChartsOption, SetOptionOpts } from \"echarts\";\nimport { BarChart, LineChart, PieChart, RadarChart, ScatterChart } from \"echarts/charts\";\nimport {\n  GridComponent,\n  LegendComponent,\n  TitleComponent,\n  TooltipComponent,\n} from \"echarts/components\";\nimport * as echarts from \"echarts/core\";\nimport { SVGRenderer } from \"echarts/renderers\";\nimport type { Component, ComponentProps, JSX } from \"solid-js\";\nimport {\n  createContext,\n  createEffect,\n  createSignal,\n  mergeProps,\n  on,\n  onCleanup,\n  onMount,\n  splitProps,\n  useContext,\n} from \"solid-js\";\nimport { cn } from \"@/lib/utils\";\n\n// Register ECharts components - using SVG renderer for crisp rendering\necharts.use([\n  SVGRenderer,\n  GridComponent,\n  TitleComponent,\n  TooltipComponent,\n  LegendComponent,\n  BarChart,\n  LineChart,\n  PieChart,\n  RadarChart,\n  ScatterChart,\n]);\n\n// ============================================================================\n// Types\n// ============================================================================\n\n/**\n * Configuration for chart series styling and labeling.\n * Similar to shadcn's ChartConfig for familiarity.\n */\nexport type ChartConfig = {\n  [key: string]: {\n    /** Human-readable label for the series */\n    label?: JSX.Element | string;\n    /** Icon component to show in legends/tooltips */\n    icon?: Component;\n    /** Static color value (hex, hsl, oklch, or CSS variable) */\n    color?: string;\n    /** Theme-aware colors for light/dark mode */\n    theme?: {\n      light: string;\n      dark: string;\n    };\n  };\n};\n\nexport type ChartContainerProps = ComponentProps<\"div\"> & {\n  /** ECharts option configuration */\n  option: EChartsOption;\n  /** Chart configuration for series styling */\n  config?: ChartConfig;\n  /** Whether to show loading animation */\n  loading?: boolean;\n  /** Loading options for ECharts */\n  loadingOptions?: object;\n  /** Options for setOption call */\n  setOptionOpts?: SetOptionOpts;\n  /** ECharts theme name (not used, we use CSS variables) */\n  theme?: string;\n  /** Callback when chart instance is initialized */\n  onInit?: (chart: ECharts) => void;\n  /** Event handlers for chart events */\n  eventHandlers?: Record<string, (params: unknown) => void>;\n};\n\n// ============================================================================\n// Context\n// ============================================================================\n\ntype ChartContextValue = {\n  config: ChartConfig;\n};\n\nconst ChartContext = createContext<ChartContextValue>({ config: {} });\n\nexport function useChart() {\n  const context = useContext(ChartContext);\n  if (!context) {\n    throw new Error(\"useChart must be used within a ChartContainer\");\n  }\n  return context;\n}\n\n// ============================================================================\n// Utilities\n// ============================================================================\n\n/**\n * Get the computed color from a config entry.\n * Handles CSS variables, theme colors, and static colors.\n */\nfunction getConfigColor(\n  configEntry: ChartConfig[string] | undefined,\n  isDark: boolean,\n): string | undefined {\n  if (!configEntry) return undefined;\n\n  if (configEntry.theme) {\n    return isDark ? configEntry.theme.dark : configEntry.theme.light;\n  }\n\n  return configEntry.color;\n}\n\n/**\n * Build CSS custom properties for chart colors from config.\n * This mimics shadcn's approach of injecting --color-{key} variables.\n */\nfunction buildChartStyles(config: ChartConfig, isDark: boolean): Record<string, string> {\n  const styles: Record<string, string> = {};\n\n  for (const [key, value] of Object.entries(config)) {\n    const color = getConfigColor(value, isDark);\n    if (color) {\n      styles[`--color-${key}`] = color;\n    }\n  }\n\n  return styles;\n}\n\n/**\n * Check if dark mode is active by looking for the data-kb-theme attribute.\n */\nfunction useIsDarkMode() {\n  const [isDark, setIsDark] = createSignal(false);\n\n  onMount(() => {\n    // Initial check\n    const html = document.documentElement;\n    setIsDark(html.getAttribute(\"data-kb-theme\") === \"dark\");\n\n    // Watch for theme changes\n    const observer = new MutationObserver((mutations) => {\n      for (const mutation of mutations) {\n        if (mutation.type === \"attributes\" && mutation.attributeName === \"data-kb-theme\") {\n          setIsDark(html.getAttribute(\"data-kb-theme\") === \"dark\");\n        }\n      }\n    });\n\n    observer.observe(html, { attributes: true });\n    onCleanup(() => observer.disconnect());\n  });\n\n  return isDark;\n}\n\n// ============================================================================\n// ChartContainer Component\n// ============================================================================\n\n/**\n * ChartContainer is the main wrapper component for ECharts.\n * It handles:\n * - SVG rendering for crisp graphics\n * - Automatic resizing\n * - Theme integration via CSS variables\n * - Loading states\n * - Proper cleanup on unmount\n */\nfunction ChartContainer(props: ChartContainerProps) {\n  const mergedProps = mergeProps(\n    {\n      config: {} as ChartConfig,\n      loading: false,\n      loadingOptions: {},\n      setOptionOpts: { notMerge: true } as SetOptionOpts,\n    },\n    props,\n  );\n\n  const [local, others] = splitProps(mergedProps, [\n    \"class\",\n    \"children\",\n    \"option\",\n    \"config\",\n    \"loading\",\n    \"loadingOptions\",\n    \"setOptionOpts\",\n    \"theme\",\n    \"onInit\",\n    \"eventHandlers\",\n    \"style\",\n  ]);\n\n  let containerRef: HTMLDivElement | undefined;\n  let chartInstance: ECharts | undefined;\n\n  const isDark = useIsDarkMode();\n\n  // Initialize chart\n  onMount(() => {\n    if (!containerRef) return;\n\n    // Initialize with SVG renderer\n    chartInstance = echarts.init(containerRef, undefined, {\n      renderer: \"svg\",\n    });\n\n    // Set initial option\n    chartInstance.setOption(local.option, local.setOptionOpts);\n\n    // Register event handlers\n    if (local.eventHandlers) {\n      for (const [event, handler] of Object.entries(local.eventHandlers)) {\n        chartInstance.on(event, handler);\n      }\n    }\n\n    // Call onInit callback\n    local.onInit?.(chartInstance);\n\n    // Setup resize observer\n    const resizeObserver = new ResizeObserver(() => {\n      chartInstance?.resize();\n    });\n    resizeObserver.observe(containerRef);\n\n    onCleanup(() => {\n      resizeObserver.disconnect();\n      chartInstance?.dispose();\n    });\n  });\n\n  // Update option when it changes\n  createEffect(\n    on(\n      () => local.option,\n      (newOption) => {\n        chartInstance?.setOption(newOption, local.setOptionOpts);\n      },\n      { defer: true },\n    ),\n  );\n\n  // Handle loading state\n  createEffect(\n    on(\n      () => local.loading,\n      (isLoading) => {\n        if (isLoading) {\n          chartInstance?.showLoading(\"default\", local.loadingOptions);\n        } else {\n          chartInstance?.hideLoading();\n        }\n      },\n    ),\n  );\n\n  // Compute styles with chart color variables\n  const chartStyles = () => {\n    const configStyles = buildChartStyles(local.config, isDark());\n    const userStyles = typeof local.style === \"object\" ? (local.style as object) : {};\n    return { ...configStyles, ...userStyles };\n  };\n\n  return (\n    <ChartContext.Provider value={{ config: local.config }}>\n      <div\n        ref={containerRef}\n        data-slot=\"chart\"\n        data-chart\n        class={cn(\n          \"flex aspect-video justify-center text-xs\",\n          \"[&_.echarts-tooltip]:rounded-lg [&_.echarts-tooltip]:border [&_.echarts-tooltip]:border-border/50 [&_.echarts-tooltip]:bg-background [&_.echarts-tooltip]:text-foreground [&_.echarts-tooltip]:shadow-xl\",\n          local.class,\n        )}\n        style={chartStyles()}\n        {...others}\n      >\n        {local.children}\n      </div>\n    </ChartContext.Provider>\n  );\n}\n\n// ============================================================================\n// Chart Tooltip Styling\n// ============================================================================\n\n/**\n * Default tooltip formatter that matches shadcn styling.\n * Use this with ECharts tooltip.formatter option.\n */\nexport function createChartTooltipFormatter(config: ChartConfig): (params: unknown) => string {\n  return (params: unknown) => {\n    const data = Array.isArray(params) ? params : [params];\n\n    const items = data\n      .map((item: { seriesName?: string; value?: unknown; color?: string }) => {\n        const configEntry = config[item.seriesName || \"\"];\n        const label = configEntry?.label || item.seriesName || \"Value\";\n        const color = configEntry?.color || item.color || \"var(--color-foreground)\";\n\n        return `\n          <div style=\"display: flex; align-items: center; gap: 8px; padding: 2px 0;\">\n            <div style=\"width: 8px; height: 8px; border-radius: 50%; background: ${color};\"></div>\n            <span style=\"color: var(--color-muted-foreground);\">${label}:</span>\n            <span style=\"font-weight: 500;\">${item.value}</span>\n          </div>\n        `;\n      })\n      .join(\"\");\n\n    return `<div style=\"padding: 4px 0;\">${items}</div>`;\n  };\n}\n\n/**\n * Default ECharts tooltip options that match shadcn styling.\n * Merge this with your tooltip configuration.\n */\nexport const chartTooltipDefaults = {\n  trigger: \"axis\" as const,\n  backgroundColor: \"var(--background)\",\n  borderColor: \"var(--border)\",\n  borderWidth: 1,\n  padding: [8, 12],\n  textStyle: {\n    color: \"var(--foreground)\",\n    fontSize: 12,\n  },\n  axisPointer: {\n    type: \"shadow\" as const,\n    shadowStyle: {\n      color: \"rgba(0, 0, 0, 0.06)\",\n    },\n  },\n};\n\n// ============================================================================\n// Chart Legend Styling\n// ============================================================================\n\n/**\n * Default ECharts legend options that match shadcn styling.\n */\nexport const chartLegendDefaults = {\n  textStyle: {\n    color: \"var(--foreground)\",\n    fontSize: 12,\n  },\n  itemGap: 16,\n  itemWidth: 12,\n  itemHeight: 12,\n  icon: \"circle\",\n};\n\n// ============================================================================\n// Chart Grid Styling\n// ============================================================================\n\n/**\n * Default ECharts grid options.\n */\nexport const chartGridDefaults = {\n  left: \"3%\",\n  right: \"4%\",\n  bottom: \"3%\",\n  containLabel: true,\n};\n\n// ============================================================================\n// Chart Axis Styling\n// ============================================================================\n\n/**\n * Default x-axis options that match shadcn styling.\n */\nexport const chartXAxisDefaults = {\n  axisLine: {\n    lineStyle: {\n      color: \"var(--border)\",\n    },\n  },\n  axisTick: {\n    show: false,\n  },\n  axisLabel: {\n    color: \"var(--muted-foreground)\",\n    fontSize: 12,\n  },\n  splitLine: {\n    show: false,\n  },\n};\n\n/**\n * Default y-axis options that match shadcn styling.\n */\nexport const chartYAxisDefaults = {\n  axisLine: {\n    show: false,\n  },\n  axisTick: {\n    show: false,\n  },\n  axisLabel: {\n    color: \"var(--muted-foreground)\",\n    fontSize: 12,\n  },\n  splitLine: {\n    lineStyle: {\n      color: \"var(--border)\",\n      type: \"dashed\" as const,\n    },\n  },\n};\n\n// ============================================================================\n// Preset Color Palettes\n// ============================================================================\n\n/**\n * Default chart color palette using CSS variables.\n * These correspond to --chart-1 through --chart-5.\n */\nexport const chartColors = [\n  \"var(--chart-1)\",\n  \"var(--chart-2)\",\n  \"var(--chart-3)\",\n  \"var(--chart-4)\",\n  \"var(--chart-5)\",\n];\n\n/**\n * Create an ECharts color configuration using the theme's chart colors.\n */\nexport function createChartColorConfig(): { color: string[] } {\n  return { color: chartColors };\n}\n\n// ============================================================================\n// Exports\n// ============================================================================\n\nexport { ChartContainer };\n",
      "type": "registry:ui"
    }
  ],
  "type": "registry:ui"
}
